<html>
<head></head>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest"></script>
    <script lang="js">
        
async function run() {
    const trainingUrl = '/data/wdbc-train.csv';

    // Load and preprocess the training data
    const trainingData = tf.data.csv(trainingUrl, {
        columnConfigs: {
            diagnosis: { isLabel: true } // Specify 'diagnosis' as the label column
        }
    });

    // Convert the training data into arrays
    const convertedTrainingData = trainingData.map(({ xs, ys }) => {
        // Convert xs to a Tensor and ys to a scalar
        return { xs: Object.values(xs), ys: ys.diagnosis };
    }).batch(32); // Use a batch size of 32

    const testingUrl = '/data/wdbc-test.csv';

    // Load and preprocess the testing data
    const testingData = tf.data.csv(testingUrl, {
        columnConfigs: {
            diagnosis: { isLabel: true } // Specify 'diagnosis' as the label column
        }
    });

    // Convert the testing data into arrays
    const convertedTestingData = testingData.map(({ xs, ys }) => {
        // Convert xs to a Tensor and ys to a scalar
        return { xs: Object.values(xs), ys: ys.diagnosis };
    }).batch(32); // Use a batch size of 32

    // Determine the number of features
    const numOfFeatures = await trainingData.take(1).toArray().then(samples => {
        return Object.keys(samples[0].xs).length;
    });

    // Build the model
    const model = tf.sequential();

    // Add input and hidden layers
    model.add(tf.layers.dense({ inputShape: [numOfFeatures], units: 32, activation: 'relu' }));
    model.add(tf.layers.dense({ units: 16, activation: 'relu' }));

    // Add output layer
    model.add(tf.layers.dense({ units: 1, activation: 'sigmoid' }));

    // Compile the model
    model.compile({
        optimizer: 'rmsprop',
        loss: 'binaryCrossentropy',
        metrics: ['accuracy']
    });

    // Train the model
    await model.fitDataset(convertedTrainingData, {
        epochs: 100,
        validationData: convertedTestingData,
        callbacks: {
            onEpochEnd: async (epoch, logs) => {
                console.log("Epoch: " + epoch + " Loss: " + logs.loss + " Accuracy: " + logs.acc);
            }
        }
    });

    // Save the model
    await model.save('downloads://my_model');
}
run();

    </script>
<body>
</body>
</html>
